name: GitHub Actions Test
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: [push]
jobs:
    explore-actions:
        runs-on: ubuntu-latest
        steps:
            - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
            - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
            - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
            - name: Check out repository code
              uses: actions/checkout@v4
            - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
            - name: Install Zola
              run: |
                sudo snap install zola --edge
            - name: Build Zola Application
              run: |
                zola build
                echo "Files in build directory"
                ls ${{ github.workspace}}/public
            - name: Debug SSH connection and copy files
              env:
                SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
                REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
                REMOTE_USER: ${{ secrets.REMOTE_USER }}
              run: |
                echo "$SSH_PRIVATE_KEY" > private_key.pem
                chmod 600 private_key.pem
                echo "Debugging SSH connection..."
                ssh -i private_key.pem -o StrictHostKeyChecking=no -vvv $REMOTE_USER@$REMOTE_HOST "echo SSH connection successful"
                if [ $? -eq 0 ]; then
                  echo "SSH connection successful, proceeding with file operations"
                  ssh -i private_key.pem -o StrictHostKeyChecking=no $REMOTE_USER@$REMOTE_HOST "rm -rf /var/www/html/*"
                  scp -i private_key.pem -r ${{ github.workspace }}/public/* $REMOTE_USER@$REMOTE_HOST:/var/www/html/
                else
                  echo "SSH connection failed. Please check your SSH key and server configuration."
                  exit 1
                fi
                rm -f private_key.pem
            - run: echo "üçè This job's status is ${{ job.status }}."